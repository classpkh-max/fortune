<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš´ì„¸í•˜ë£¨ - ì˜¤ëŠ˜ì˜ ìš´ì„¸, ê¶í•©, ì‚¬ì£¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ëª¨ë“  CSS ìŠ¤íƒ€ì¼ì„ ì—¬ê¸°ì— í†µí•© -->
    <style>
        /* Google Fonts - Inter (Korean font not specified, so using Inter/system default) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        :root {
            --color-primary: #D946EF; /* Pink-600 */
            --color-secondary: #F43F5E; /* Rose-500 */
            --color-accent: #6D28D9; /* Violet-700 */
            --color-bg: #FFFFFF;
            --color-text: #1F2937; /* Gray-800 */
            --color-subtext: #4B5563; /* Gray-600 */
        }

        /* Base Styles */
        * {
            box-sizing: border-box;
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #f3f4f6; /* Lighter background for body */
            color: var(--color-text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .header {
            background-color: var(--color-primary);
            color: white;
            padding: 1.5rem 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .site-title {
            font-size: 2.2rem;
            font-weight: 900;
            margin: 0;
            letter-spacing: -0.5px;
        }

        .site-subtitle {
            font-size: 0.9rem;
            margin-top: 0.25rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* General Card and Button Styling */
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e5e7eb;
        }

        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease-in-out;
            border: none;
            text-decoration: none;
        }

        .btn-primary {
            background-color: var(--color-secondary);
            color: white;
            box-shadow: 0 4px 6px rgba(244, 63, 94, 0.4);
        }

        .btn-primary:hover {
            background-color: #E11D48; /* Deeper red */
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(244, 63, 94, 0.5);
        }

        .btn-disabled {
            background-color: #A3A3A3;
            color: #E5E5E5;
            cursor: not-allowed;
            box-shadow: none;
        }
        .btn-disabled:hover {
            transform: none;
        }

        /* Index/Main View - Menu Grid */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .menu-card {
            border: 3px solid var(--color-primary);
            background-color: #fce7f3; /* Pink-50 */
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            padding: 2rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
        }

        .menu-card:hover {
            background-color: #FBCFE8; /* Pink-200 */
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .menu-card.active {
            background-color: var(--color-primary);
            color: white;
            border-color: var(--color-accent);
            box-shadow: 0 5px 15px rgba(217, 70, 239, 0.5);
        }

        /* Input Form Styling */
        .form-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap; /* Add responsiveness */
        }

        .form-group > select {
            flex: 1;
            min-width: 100px;
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            background-color: white;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-group > select:focus {
            border-color: var(--color-primary);
            outline: none;
        }

        .form-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            color: var(--color-accent);
        }

        /* Ad View Styling */
        .ad-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px; 
            text-align: center;
        }

        .ad-area {
            width: 100%;
            max-width: 728px;
            height: 200px; /* Placeholder height */
            background-color: #E5E7EB; /* Light gray placeholder */
            border: 2px dashed #9CA3AF;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 2rem 0;
            border-radius: 8px;
            color: #6B7280;
            font-weight: 600;
        }

        .countdown {
            font-size: 3rem;
            font-weight: 900;
            color: var(--color-secondary);
            margin: 1rem 0;
        }

        /* Result View Styling */
        .result-header {
            text-align: center;
            padding: 1.5rem 0;
        }

        #result-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--color-accent);
            margin-bottom: 0.5rem;
        }

        #result-summary {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--color-subtext);
            margin-bottom: 1.5rem;
            padding: 0.5rem 1rem;
            border-bottom: 2px solid #EEE;
        }

        #fortune-result-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .fortune-card {
            background-color: #F9FAFB; /* Lightest gray */
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 5px solid var(--color-primary);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-top: 0;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #E5E7EB;
        }

        .card-content {
            font-size: 1rem;
            line-height: 1.7;
            color: var(--color-text);
            white-space: pre-wrap; /* For line breaks from Gemini API */
        }

        /* Special Cards */
        .advice-card {
            border-left-color: var(--color-secondary);
            background-color: #FEF2F2; /* Red-50 */
        }
        .advice-card .card-title {
            color: var(--color-secondary);
        }

        .score-card {
            grid-column: 1 / -1; /* Full width on mobile/tablet */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-primary) 100%);
            color: white !important;
            text-align: center;
            border-left: none;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .score-card h2 { color: white !important; border-bottom: none; margin: 0; }
        .score-card p { color: white !important; margin: 0; }

        /* Loading Spinner */
        #loading-spinner {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--color-accent);
        }

        .spinner {
            border: 4px solid rgba(217, 70, 239, 0.2);
            border-top: 4px solid var(--color-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Grid Adjustments */
        @media (min-width: 768px) {
            .container {
                padding: 2rem;
            }
            .menu-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            #fortune-result-container {
                grid-template-columns: repeat(2, 1fr);
            }
            .score-card {
                padding: 3rem;
            }
        }

        @media (min-width: 1024px) {
             #fortune-result-container {
                grid-template-columns: repeat(3, 1fr);
            }
            .score-card {
                grid-column: 1 / 2; /* Score takes 1 column on large screens */
            }
            /* Adjust subsequent cards to span 2 columns to balance layout */
            .score-card + .fortune-card:nth-of-type(1),
            .score-card + .fortune-card:nth-of-type(2) {
                grid-column: span 2;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1 class="site-title">ìš´ì„¸í•˜ë£¨</h1>
        <p class="site-subtitle">ìƒë…„ì›”ì¼ê³¼ íƒœì–´ë‚œ ì‹œê°„ìœ¼ë¡œ ë³´ëŠ” ì˜¤ëŠ˜ì˜ ìš´ì„¸ì™€ ê¶í•©</p>
    </header>

    <main id="app-main" class="container">
        <!-- í˜ì´ì§€ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
    </main>

    <!-- ëª¨ë“  JavaScript ë¡œì§ í†µí•© -->
    <script type="module">
        // =================================================================================
        // fortune.js ë¡œì§ í†µí•© ë° API í‚¤ ì„¤ì • (ë³´ì•ˆìƒ ë¹ˆ ë¬¸ìì—´ë¡œ ì„¤ì •)
        // =================================================================================

        const apiKey = ""; 
        const GEMINI_MODEL = "gemini-2.5-flash-preview-09-2025";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${apiKey}`;
        const SITE_NAME = "ìš´ì„¸í•˜ë£¨";

        const ZODIAC_SIGNS = [
            "ì¥(å­)", "ì†Œ(ä¸‘)", "í˜¸ë‘ì´(å¯…)", "í† ë¼(å¯)",
            "ìš©(è¾°)", "ë±€(å·³)", "ë§(åˆ)", "ì–‘(æœª)",
            "ì›ìˆ­ì´(ç”³)", "ë‹­(é…‰)", "ê°œ(æˆŒ)", "ë¼ì§€(äº¥)"
        ];

        function getFiveElement(year) {
            const lastDigit = year % 10;
            if (lastDigit === 4 || lastDigit === 5) return "ëª©(æœ¨)";
            if (lastDigit === 6 || lastDigit === 7) return "í™”(ç«)";
            if (lastDigit === 8 || lastDigit === 9) return "í† (åœŸ)";
            if (lastDigit === 0 || lastDigit === 1) return "ê¸ˆ(é‡‘)";
            if (lastDigit === 2 || lastDigit === 3) return "ìˆ˜(æ°´)";
            return "í† (åœŸ)";
        }

        function getZodiacSign(year) {
            const startYear = 1900;
            const index = (year - startYear) % 12;
            return ZODIAC_SIGNS[index];
        }

        function calculateSajuInfo(userData) {
            const today = new Date();
            const year = parseInt(userData.year);
            const month = parseInt(userData.month);
            const day = parseInt(userData.day);
            
            const age = today.getFullYear() - year + 1; // í•œêµ­ì‹ ë‚˜ì´
            const zodiacSign = getZodiacSign(year);
            const element = getFiveElement(year);

            return {
                ...userData,
                age,
                zodiacSign,
                element,
                birthDate: `${year}ë…„ ${month}ì›” ${day}ì¼ ${userData.hour}ì‹œ`,
            };
        }

        // --- Prompt Builders (Simplified for brevity, structure remains) ---

        function buildSexCompatibilityPrompt(user, partner) {
            const userSaju = calculateSajuInfo(user);
            const partnerSaju = calculateSajuInfo(partner);
            const ageDiff = Math.abs(userSaju.age - partnerSaju.age);
            
            const systemPrompt = `ë‹¹ì‹ ì€ ${SITE_NAME}ì˜ ìˆ™ë ¨ëœ ê¶í•© ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë‹¤ìŒ ë‘ ì‚¬ëŒì˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ 'ì†ê¶í•©'ì— ëŒ€í•œ ìì„¸í•˜ê³  ë¶€ë“œëŸ¬ìš´ ìš´ì„¸ ê²°ê³¼ë¥¼ í•œêµ­ì–´ ì¡´ëŒ“ë§ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì‘ë‹µì€ ë°˜ë“œì‹œ ì•„ë˜ ì •ì˜ëœ JSON Schemaì— ë§ëŠ” ë¬¸ìì—´ í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤.`;
            const userQuery = `ìš´ì„¸ ì¢…ë¥˜: ì†ê¶í•©. ë‚˜ì˜ ì •ë³´: ${userSaju.birthDate}, ë : ${userSaju.zodiacSign}, ì˜¤í–‰: ${userSaju.element}, íƒœì–´ë‚œ ì‹œê°„: ${userSaju.hour}. ìƒëŒ€ë°© ì •ë³´: ${partnerSaju.birthDate}, ë : ${partnerSaju.zodiacSign}, ì˜¤í–‰: ${partnerSaju.element}, íƒœì–´ë‚œ ì‹œê°„: ${partnerSaju.hour}. ë‚˜ì´ ì°¨ì´: ${ageDiff}ì„¸.`;

            const responseSchema = {
                type: "OBJECT",
                properties: {
                    "score": { "type": "NUMBER" },
                    "grade": { "type": "STRING" },
                    "summary": { "type": "STRING" },
                    "passion": { "type": "STRING" },
                    "rhythm": { "type": "STRING" },
                    "strengths": { "type": "STRING" },
                    "weaknesses": { "type": "STRING" },
                    "advice": { "type": "STRING" }
                },
                required: ["score", "grade", "summary", "passion", "rhythm", "strengths", "weaknesses", "advice"]
            };

            return { systemPrompt, userQuery, responseSchema };
        }
        
        function buildTodayFortunePrompt(user) {
            const userSaju = calculateSajuInfo(user);
            const today = new Date();
            const todayDate = `${today.getFullYear()}ë…„ ${today.getMonth() + 1}ì›” ${today.getDate()}ì¼`;

            const systemPrompt = `ë‹¹ì‹ ì€ ${SITE_NAME}ì˜ ì „ë¬¸ ì—­ìˆ ì¸ì…ë‹ˆë‹¤. ì˜¤ëŠ˜(${todayDate})ì˜ ìš´ì„¸ë¥¼ ì•„ë˜ ì‚¬ìš©ìì˜ ì‚¬ì£¼ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìì„¸í•˜ê²Œ í’€ì–´ì£¼ì„¸ìš”. ì‘ë‹µì€ ë°˜ë“œì‹œ ì•„ë˜ ì •ì˜ëœ JSON Schemaì— ë§ëŠ” ë¬¸ìì—´ í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤.`;
            const userQuery = `ìš´ì„¸ ì¢…ë¥˜: ì˜¤ëŠ˜ì˜ ìš´ì„¸. ì˜¤ëŠ˜ ë‚ ì§œ: ${todayDate}. ì‚¬ìš©ì ì •ë³´: ${userSaju.birthDate}, ë : ${userSaju.zodiacSign}, ì˜¤í–‰: ${userSaju.element}, íƒœì–´ë‚œ ì‹œê°„: ${userSaju.hour}.`;

            const responseSchema = {
                type: "OBJECT",
                properties: {
                    "summary": { "type": "STRING" },
                    "overall": { "type": "STRING" },
                    "love": { "type": "STRING" },
                    "money": { "type": "STRING" },
                    "health": { "type": "STRING" },
                    "advice": { "type": "STRING" }
                },
                required: ["summary", "overall", "love", "money", "health", "advice"]
            };

            return { systemPrompt, userQuery, responseSchema };
        }

        function getSimpleNewYearGrade(user, targetYear) {
            const base = (parseInt(user.year) + parseInt(user.month) + parseInt(user.day) + targetYear) % 12;
            let score = 0;
            let grade = "í‰(å¹³)";

            if (base < 2) { grade = "ëŒ€ê¸¸(å¤§å‰)"; score = 90 + base * 5; }
            else if (base < 4) { grade = "ê¸¸(å‰)"; score = 80 + base * 2; }
            else if (base < 6) { grade = "ë°˜ê¸¸(åŠå‰)"; score = 70 + base * 1; }
            else if (base < 8) { grade = "í‰(å¹³)"; score = 60 + base * 0.5; }
            else if (base < 10) { grade = "ë°˜í‰(åŠå‡¶)"; score = 50 + base * 0.2; }
            else { grade = "í‰(å‡¶)"; score = 40 + base * 0.1; }

            return { grade, score: Math.round(score) };
        }

        function buildYearFortunePrompt(user, targetYear) {
            const userSaju = calculateSajuInfo(user);
            const { grade, score } = getSimpleNewYearGrade(user, targetYear);

            const systemPrompt = `ë‹¹ì‹ ì€ ${SITE_NAME}ì˜ ì „ë¬¸ ì—­ìˆ ì¸ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ì‚¬ì£¼ ì •ë³´ì™€ ê°„ì´ í† ì •ë¹„ê²° ì ìˆ˜ë¥¼ ì°¸ê³ í•˜ì—¬, ${targetYear}ë…„ í•œ í•´ì˜ ìš´ì„¸ë¥¼ ìì„¸í•˜ê²Œ í’€ì–´ì£¼ì„¸ìš”. ìš´ì„¸ì˜ ë¶„ìœ„ê¸°ëŠ” 'ê°„ì´ ë“±ê¸‰: ${grade} (ì ìˆ˜: ${score}ì )'ì— ë§ì¶° ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì‘ë‹µì€ ë°˜ë“œì‹œ ì•„ë˜ ì •ì˜ëœ JSON Schemaì— ë§ëŠ” ë¬¸ìì—´ í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤.`;
            const userQuery = `ìš´ì„¸ ì¢…ë¥˜: ${targetYear}ë…„ ì‹ ë…„ ìš´ì„¸. ì‚¬ìš©ì ì •ë³´: ${userSaju.birthDate}, ë : ${userSaju.zodiacSign}, ì˜¤í–‰: ${userSaju.element}, íƒœì–´ë‚œ ì‹œê°„: ${userSaju.hour}. ê°„ì´ ë“±ê¸‰: ${grade} (ì ìˆ˜: ${score}ì ).`;

            const responseSchema = {
                type: "OBJECT",
                properties: {
                    "summary": { "type": "STRING" }, "grade": { "type": "STRING" },
                    "overall": { "type": "STRING" }, "money": { "type": "STRING" },
                    "relationship": { "type": "STRING" }, "career": { "type": "STRING" },
                    "warning": { "type": "STRING" }, "keywords": { "type": "ARRAY", "items": { "type": "STRING" } }
                },
                required: ["summary", "grade", "overall", "money", "relationship", "career", "warning", "keywords"]
            };

            return { systemPrompt, userQuery, responseSchema };
        }

        function buildSajuCompatibilityPrompt(user, partner) {
            const userSaju = calculateSajuInfo(user);
            const partnerSaju = calculateSajuInfo(partner);
            const ageDiff = Math.abs(userSaju.age - partnerSaju.age);

            const systemPrompt = `ë‹¹ì‹ ì€ ${SITE_NAME}ì˜ ìˆ™ë ¨ëœ ê¶í•© ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë‹¤ìŒ ë‘ ì‚¬ëŒì˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ 'ì‚¬ì£¼ ê¶í•©'ì— ëŒ€í•œ ìì„¸í•˜ê³  ë¶€ë“œëŸ¬ìš´ ìš´ì„¸ ê²°ê³¼ë¥¼ í•œêµ­ì–´ ì¡´ëŒ“ë§ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì‘ë‹µì€ ë°˜ë“œì‹œ ì•„ë˜ ì •ì˜ëœ JSON Schemaì— ë§ëŠ” ë¬¸ìì—´ í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤.`;
            const userQuery = `ìš´ì„¸ ì¢…ë¥˜: ì‚¬ì£¼ ê¶í•© (ì¥ê¸°ì  ê´€ì ). ë‚˜ì˜ ì •ë³´: ${userSaju.birthDate}, ë : ${userSaju.zodiacSign}, ì˜¤í–‰: ${userSaju.element}, íƒœì–´ë‚œ ì‹œê°„: ${userSaju.hour}. ìƒëŒ€ë°© ì •ë³´: ${partnerSaju.birthDate}, ë : ${partnerSaju.zodiacSign}, ì˜¤í–‰: ${partnerSaju.element}, íƒœì–´ë‚œ ì‹œê°„: ${partnerSaju.hour}. ë‚˜ì´ ì°¨ì´: ${ageDiff}ì„¸.`;

            const responseSchema = {
                type: "OBJECT",
                properties: {
                    "score": { "type": "NUMBER" }, "grade": { "type": "STRING" },
                    "summary": { "type": "STRING" }, "strengths": { "type": "STRING" },
                    "conflicts": { "type": "STRING" }, "future": { "type": "STRING" },
                    "advice": { "type": "STRING" }
                },
                required: ["score", "grade", "summary", "strengths", "conflicts", "future", "advice"]
            };

            return { systemPrompt, userQuery, responseSchema };
        }

        async function fetchFortuneResult(mode, user, partner = null) {
            if (!apiKey) {
                 // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” API í‚¤ê°€ ì„¤ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
            }

            let promptBuilder;

            switch (mode) {
                case 'SEX_COMPATIBILITY': promptBuilder = buildSexCompatibilityPrompt(user, partner); break;
                case 'TODAY_FORTUNE': promptBuilder = buildTodayFortunePrompt(user); break;
                case 'YEAR_FORTUNE':
                    const targetYear = new Date().getFullYear();
                    promptBuilder = buildYearFortunePrompt(user, targetYear);
                    break;
                case 'SAJU_COMPATIBILITY': promptBuilder = buildSajuCompatibilityPrompt(user, partner); break;
                default: throw new Error("ìœ íš¨í•˜ì§€ ì•Šì€ ìš´ì„¸ ëª¨ë“œì…ë‹ˆë‹¤.");
            }

            const payload = {
                contents: [{ parts: [{ text: promptBuilder.userQuery }] }],
                systemInstruction: { parts: [{ text: promptBuilder.systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: promptBuilder.responseSchema
                }
            };

            // API í˜¸ì¶œ (ì—¬ê¸°ì— ì§€ìˆ˜ ë°±ì˜¤í”„ ë¡œì§ì„ ì¶”ê°€í•  ìˆ˜ ìˆì§€ë§Œ, ì˜ˆì œì—ì„œëŠ” ë‹¨ìˆœí™”)
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error("HTTP ì˜¤ë¥˜:", errorText);
                    throw new Error("ìš´ì„¸ ìƒì„± ì¤‘ API ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                }

                const result = await response.json();
                const responseText = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                if (!responseText) {
                    throw new Error("ìš´ì„¸ ê²°ê³¼ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                }

                return JSON.parse(responseText);

            } catch (error) {
                console.error("API í˜¸ì¶œ ì¤‘ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ ë°œìƒ:", error);
                throw new Error(error.message || "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            }
        }


        // =================================================================================
        // ui.js ë° HTML ë·° ê´€ë¦¬ ë¡œì§ í†µí•©
        // =================================================================================

        // LocalStorage í‚¤ ê´€ë¦¬
        const LS_KEYS = {
            mode: "fortune_mode",
            user: "fortune_user_data",
            partner: "fortune_partner_data",
            result: "fortune_result"
        };

        const JISHI_DATA = [
            { value: "ì", range: "23:30~01:29", emoji: "ğŸ­" }, { value: "ì¶•", range: "01:30~03:29", emoji: "ğŸ®" },
            { value: "ì¸", range: "03:30~05:29", emoji: "ğŸ¯" }, { value: "ë¬˜", range: "05:30~07:29", emoji: "ğŸ°" },
            { value: "ì§„", range: "07:30~09:29", emoji: "ğŸ²" }, { value: "ì‚¬", range: "09:30~11:29", emoji: "ğŸ" },
            { value: "ì˜¤", range: "11:30~13:29", emoji: "ğŸ´" }, { value: "ë¯¸", range: "13:30~15:29", emoji: "ğŸ‘" },
            { value: "ì‹ ", range: "15:30~17:29", emoji: "ğŸµ" }, { value: "ìœ ", range: "17:30~19:29", emoji: "ğŸ”" },
            { value: "ìˆ ", range: "19:30~21:29", emoji: "ğŸ¶" }, { value: "í•´", range: "21:30~23:29", emoji: "ğŸ·" }
        ];

        const MODE_CONFIG = {
            TODAY_FORTUNE: { name: "ì˜¤ëŠ˜ì˜ ìš´ì„¸", needsPartner: false },
            YEAR_FORTUNE: { name: "ì‹ ë…„ ìš´ì„¸", needsPartner: false },
            SAJU_COMPATIBILITY: { name: "ì‚¬ì£¼ ê¶í•©", needsPartner: true },
            SEX_COMPATIBILITY: { name: "ì†ê¶í•©", needsPartner: true },
        };

        // --- View Switching (Router) ---
        function navigateTo(viewName) {
            const mainEl = document.getElementById('app-main');
            mainEl.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

            switch (viewName) {
                case 'main': renderMainView(); break;
                case 'ad': renderAdView(); break;
                case 'result': renderResultView(); break;
            }
        }


        // --- Helper Functions ---

        function populateYears(selector) {
            const currentYear = new Date().getFullYear();
            const startYear = 1900;
            const yearSelects = document.querySelectorAll(selector);

            yearSelects.forEach(select => {
                select.innerHTML = '<option value="" disabled selected>ë…„ë„</option>';
                for (let year = currentYear; year >= startYear; year--) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    select.appendChild(option);
                }
            });
        }

        function populateJishi(selector) {
            const hourSelects = document.querySelectorAll(selector);
            hourSelects.forEach(select => {
                select.innerHTML = '<option value="" disabled selected>íƒœì–´ë‚œ ì‹œê°„(12ì§€)</option>';
                JISHI_DATA.forEach(jishi => {
                    const option = document.createElement('option');
                    option.value = jishi.value;
                    option.textContent = `${jishi.emoji} ${jishi.value} (${jishi.range})`;
                    select.appendChild(option);
                });
            });
        }

        function toggleInputForms(mode) {
            const config = MODE_CONFIG[mode];
            const formContainer = document.getElementById('input-form-container');
            const partnerBlock = document.getElementById('partner-info-block');
            const formTitle = document.getElementById('form-title');

            if (!config) {
                formContainer.style.display = 'none';
                return;
            }

            formTitle.textContent = `${config.name}ì„(ë¥¼) ìœ„í•œ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”`;
            formContainer.style.display = 'block';

            if (config.needsPartner) {
                partnerBlock.style.display = 'block';
            } else {
                partnerBlock.style.display = 'none';
            }

            localStorage.setItem(LS_KEYS.mode, mode);
        }

        function extractFormData(prefix) {
            const year = document.getElementById(`${prefix}-year`).value;
            const month = document.getElementById(`${prefix}-month`).value;
            const day = document.getElementById(`${prefix}-day`).value;
            const hour = document.getElementById(`${prefix}-hour`).value;

            return { year, month, day, hour };
        }

        function validateData(data, isPartner = false) {
            const prefix = isPartner ? 'ìƒëŒ€ë°©' : 'ë‚˜';
            // alert() ì‚¬ìš© ë¶ˆê°€ -> ì»¤ìŠ¤í…€ ëª¨ë‹¬ì´ë‚˜ console.error ì‚¬ìš©
            if (!data.year || !data.month || !data.day || !data.hour) {
                console.error(`${prefix}ì˜ ëª¨ë“  ìƒë…„ì›”ì¼ ë° íƒœì–´ë‚œ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.`);
                // ì‚¬ìš©ìì—ê²Œ ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆë„ë¡ ê°„ë‹¨í•œ DOM ì¡°ì‘ìœ¼ë¡œ ëŒ€ì²´
                document.getElementById('form-error-message').textContent = `âš ï¸ ${prefix}ì˜ ëª¨ë“  ì •ë³´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.`;
                document.getElementById('form-error-message').style.display = 'block';
                return false;
            }
            document.getElementById('form-error-message').style.display = 'none';
            return true;
        }

        function handleGenerateFortune() {
            const mode = localStorage.getItem(LS_KEYS.mode);
            if (!mode) {
                document.getElementById('form-error-message').textContent = `âš ï¸ ìš´ì„¸ ì¢…ë¥˜ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.`;
                document.getElementById('form-error-message').style.display = 'block';
                return;
            }

            const userData = extractFormData('user');
            const config = MODE_CONFIG[mode];

            if (!validateData(userData)) return;

            let partnerData = null;
            if (config.needsPartner) {
                partnerData = extractFormData('partner');
                if (!validateData(partnerData, true)) return;
            }

            localStorage.setItem(LS_KEYS.user, JSON.stringify(userData));
            if (partnerData) {
                localStorage.setItem(LS_KEYS.partner, JSON.stringify(partnerData));
            } else {
                localStorage.removeItem(LS_KEYS.partner);
            }
            localStorage.removeItem(LS_KEYS.result);

            navigateTo('ad'); // ad.html ëŒ€ì‹  ad ë·°ë¡œ ì´ë™
        }

        function toggleLoading(show, message = "ìš´ì„¸ ê²°ê³¼ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.") {
            const loadingEl = document.getElementById('loading-spinner');
            const resultEl = document.getElementById('fortune-result-container');
            const resultContentWrapper = document.getElementById('result-content-wrapper');


            if (loadingEl) { // result ë·°ì— ìˆì„ ë•Œë§Œ ì‹¤í–‰
                 if (show) {
                    loadingEl.style.display = 'flex';
                    loadingEl.querySelector('p').textContent = message;
                    if (resultContentWrapper) resultContentWrapper.style.display = 'none';
                } else {
                    loadingEl.style.display = 'none';
                    if (resultContentWrapper && !message.includes("ì˜¤ë¥˜")) {
                         resultContentWrapper.style.display = 'block';
                    }
                }
            }
        }

        function renderFortuneResult(result, mode) {
            const config = MODE_CONFIG[mode];
            if (!config) return;

            document.getElementById('result-title').textContent = `${config.name} ê²°ê³¼`;
            document.getElementById('result-summary').textContent = result.summary;

            const resultContainer = document.getElementById('fortune-result-container');
            resultContainer.innerHTML = '';

            const sections = [];
            const resultWrapper = document.getElementById('result-content-wrapper');
            if (resultWrapper) resultWrapper.style.display = 'block';


            if (mode === 'TODAY_FORTUNE') {
                sections.push(
                    { title: "ì˜¤ëŠ˜ì˜ ì¢…í•© ìš´ì„¸", key: "overall", emoji: "âœ¨" },
                    { title: "ì‚¬ë‘/ëŒ€ì¸ê´€ê³„ ìš´", key: "love", emoji: "â¤ï¸" },
                    { title: "ê¸ˆì „/ì¬ë¬¼ ìš´", key: "money", emoji: "ğŸ’°" },
                    { title: "ê±´ê°•/ì»¨ë””ì…˜ ìš´", key: "health", emoji: "ğŸ’ª" },
                    { title: "ì˜¤ëŠ˜ì˜ ì¡°ì–¸", key: "advice", emoji: "ğŸ’¡", isAdvice: true },
                );
            } else if (mode === 'YEAR_FORTUNE') {
                const keywordsHTML = result.keywords && result.keywords.length > 0
                    ? `<div class="p-4 bg-yellow-100 border border-yellow-300 rounded-xl mt-4">
                        <h3 class="font-bold text-lg mb-2 text-yellow-800">ğŸ”‘ ì˜¬í•´ì˜ í•µì‹¬ í‚¤ì›Œë“œ</h3>
                        <div class="flex flex-wrap gap-2">
                            ${result.keywords.map(kw => `<span class="px-3 py-1 bg-white text-pink-700 font-semibold rounded-full shadow-md">${kw}</span>`).join('')}
                        </div>
                      </div>`
                    : '';
                
                const gradeCard = `<div class="fortune-card grade-card bg-pink-500 text-white shadow-xl">
                    <h2 class="text-2xl font-extrabold mb-1">ì´í‰ ë“±ê¸‰</h2>
                    <p class="text-4xl font-black">${result.grade}</p>
                </div>`;
                resultContainer.insertAdjacentHTML('beforeend', gradeCard);

                sections.push(
                    { title: "ì „ë°˜ì ì¸ ìš´ì„¸ íë¦„", key: "overall", emoji: "ğŸ§­" },
                    { title: "ì¬ë¬¼/ì‚¬ì—…/íˆ¬ì ìš´", key: "money", emoji: "ğŸ’µ" },
                    { title: "ëŒ€ì¸ ê´€ê³„/ê°€ì¡±/ë™ë£Œ", key: "relationship", emoji: "ğŸ¤" },
                    { title: "ì»¤ë¦¬ì–´/ì§ì—…/í•™ì—… ìš´", key: "career", emoji: "ğŸ’¼" },
                    { title: "ì˜¬í•´ ì£¼ì˜í•  ì ", key: "warning", emoji: "âš ï¸" },
                );
                // í‚¤ì›Œë“œëŠ” ê²°ê³¼ ì„¹ì…˜ ë°”ë¡œ ì•ì— ì‚½ì…
                const keywordsDiv = document.createElement('div');
                keywordsDiv.innerHTML = keywordsHTML;
                resultContainer.appendChild(keywordsDiv.firstChild);
                
            } else if (mode === 'SEX_COMPATIBILITY' || mode === 'SAJU_COMPATIBILITY') {
                const scoreCard = `<div class="fortune-card score-card">
                    <h2 class="text-2xl font-extrabold mb-1">ê¶í•© ì ìˆ˜</h2>
                    <p class="text-4xl font-black">${result.score}ì </p>
                    <p class="text-xl font-semibold mt-2">ë“±ê¸‰: ${result.grade}</p>
                </div>`;
                resultContainer.insertAdjacentHTML('beforeend', scoreCard);

                if (mode === 'SEX_COMPATIBILITY') {
                    sections.push(
                        { title: "ì—´ì •/ìŠ¤í‚¨ì‹­ ì½”ë“œ", key: "passion", emoji: "ğŸ”¥" },
                        { title: "ìƒí™œ ë¦¬ë“¬/ê°ì •ì„ ", key: "rhythm", emoji: "ğŸ¶" },
                        { title: "ì˜ ë§ëŠ” ë¶€ë¶„ (ê°•ì )", key: "strengths", emoji: "âœ…" },
                        { title: "ì¡°ì‹¬í•  ë¶€ë¶„ (ì£¼ì˜ì )", key: "weaknesses", emoji: "ğŸ’”" },
                        { title: "ê´€ê³„ë¥¼ ìœ„í•œ ì¡°ì–¸", key: "advice", emoji: "ğŸ’¬", isAdvice: true },
                    );
                } else {
                    sections.push(
                        { title: "ê¶í•© ê°•ì ", key: "strengths", emoji: "ğŸŒŸ" },
                        { title: "ë¶€ë”ªí ìˆ˜ ìˆëŠ” ë¶€ë¶„", key: "conflicts", emoji: "ğŸ’¥" },
                        { title: "ì¥ê¸°ì ì¸ ê´€ê³„ì˜ ê°€ëŠ¥ì„±", key: "future", emoji: "ğŸ”®" },
                        { title: "ê´€ê³„ë¥¼ ìœ„í•œ ì¡°ì–¸", key: "advice", emoji: "ğŸ’¬", isAdvice: true },
                    );
                }
            }

            sections.forEach(section => {
                const content = result[section.key] || "ìš´ì„¸ ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
                const isAdvice = section.isAdvice ? 'advice-card' : '';

                const cardHTML = `
                    <div class="fortune-card ${isAdvice}">
                        <h3 class="card-title">${section.emoji} ${section.title}</h3>
                        <p class="card-content">${content}</p>
                    </div>
                `;
                resultContainer.insertAdjacentHTML('beforeend', cardHTML);
            });
        }

        async function initializeResultPage() {
            toggleLoading(true);

            try {
                const mode = localStorage.getItem(LS_KEYS.mode);
                const userJson = localStorage.getItem(LS_KEYS.user);
                const partnerJson = localStorage.getItem(LS_KEYS.partner);

                if (!mode || !userJson) {
                    throw new Error("ìš´ì„¸ ì •ë³´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                }

                const userData = JSON.parse(userJson);
                const partnerData = partnerJson ? JSON.parse(partnerJson) : null;

                const userSaju = calculateSajuInfo(userData);
                document.getElementById('user-info-display').innerHTML = `
                    <p class="text-sm text-gray-600 mb-2">
                        ë‚˜: ${userSaju.year}ë…„ ${userSaju.month}ì›” ${userSaju.day}ì¼, ${userSaju.hour}ì‹œ
                        (ë : ${userSaju.zodiacSign}, ì˜¤í–‰: ${userSaju.element})
                    </p>
                `;

                if (partnerData) {
                    const partnerSaju = calculateSajuInfo(partnerData);
                    document.getElementById('partner-info-display').innerHTML = `
                        <p class="text-sm text-gray-600">
                            ìƒëŒ€: ${partnerSaju.year}ë…„ ${partnerSaju.month}ì›” ${partnerSaju.day}ì¼, ${partnerSaju.hour}ì‹œ
                            (ë : ${partnerSaju.zodiacSign}, ì˜¤í–‰: ${partnerSaju.element})
                        </p>
                    `;
                }

                const fortuneResult = await fetchFortuneResult(mode, userData, partnerData);
                renderFortuneResult(fortuneResult, mode);

            } catch (error) {
                console.error("ê²°ê³¼ ìƒì„± ì‹¤íŒ¨:", error);
                toggleLoading(true, `âŒ ì˜¤ë¥˜: ${error.message || "ìš´ì„¸ ìƒì„± ì¤‘ ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}`);
                
            } finally {
                // ì—ëŸ¬ ë©”ì‹œì§€ê°€ í‘œì‹œëœ ê²½ìš°ê°€ ì•„ë‹ˆë¼ë©´ ë¡œë”© í™”ë©´ ì œê±°
                if (document.getElementById('loading-spinner').style.display !== 'none' && !document.getElementById('loading-spinner').querySelector('p').textContent.includes('ì˜¤ë¥˜')) {
                    toggleLoading(false);
                }
            }
        }


        // =================================================================================
        // HTML View Renderers
        // =================================================================================

        function renderMainView() {
            const mainEl = document.getElementById('app-main');
            mainEl.innerHTML = `
                <section class="card">
                    <h2 class="text-xl font-bold mb-4" style="color: var(--color-accent);">ì›í•˜ëŠ” ìš´ì„¸ ë©”ë‰´ë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
                    <div class="menu-grid">
                        <div class="menu-card" data-mode="SEX_COMPATIBILITY">
                            ğŸ”¥ ì†ê¶í•©<br><span style="font-size: 0.8rem; opacity: 0.8;">(ë‚˜ì™€ ìƒëŒ€)</span>
                        </div>
                        <div class="menu-card" data-mode="TODAY_FORTUNE">
                            â˜€ï¸ ì˜¤ëŠ˜ì˜ ìš´ì„¸<br><span style="font-size: 0.8rem; opacity: 0.8;">(ë‚˜ì˜ ì •ë³´)</span>
                        </div>
                        <div class="menu-card" data-mode="YEAR_FORTUNE">
                            ğŸ”® ì‹ ë…„ ìš´ì„¸<br><span style="font-size: 0.8rem; opacity: 0.8;">(ë‚˜ì˜ ì •ë³´)</span>
                        </div>
                        <div class="menu-card" data-mode="SAJU_COMPATIBILITY">
                            ğŸ¤ ì‚¬ì£¼ ê¶í•©<br><span style="font-size: 0.8rem; opacity: 0.8;">(ë‚˜ì™€ ìƒëŒ€)</span>
                        </div>
                    </div>
                </section>

                <section id="input-form-container" class="card" style="display: none;">
                    <h2 id="form-title" class="form-title"></h2>
                    <p id="form-error-message" class="text-red-500 font-semibold mb-3" style="display:none;"></p>

                    <!-- ë‚˜ì˜ ì •ë³´ ì…ë ¥ ë¸”ë¡ -->
                    <div id="user-info-block" class="mb-6">
                        <h3 class="text-lg font-semibold mb-2 text-pink-700">ğŸ‘¤ ë‚˜ì˜ ì •ë³´ (ì–‘ë ¥ ê¸°ì¤€)</h3>
                        <div class="form-group">
                            <select id="user-year" class="year-select"></select>
                            <select id="user-month">
                                <option value="" disabled selected>ì›”</option>
                                ${Array.from({length: 12}, (_, i) => `<option value="${i+1}">${i+1}ì›”</option>`).join('')}
                            </select>
                            <select id="user-day">
                                <option value="" disabled selected>ì¼</option>
                                ${Array.from({length: 31}, (_, i) => `<option value="${i+1}">${i+1}ì¼</option>`).join('')}
                            </select>
                            <select id="user-hour" class="hour-select"></select>
                        </div>
                    </div>

                    <!-- ìƒëŒ€ë°© ì •ë³´ ì…ë ¥ ë¸”ë¡ (ê¶í•© ëª¨ë“œ ì‹œì—ë§Œ í‘œì‹œë¨) -->
                    <div id="partner-info-block" class="mb-6" style="display: none;">
                        <h3 class="text-lg font-semibold mb-2 text-pink-700">â¤ï¸ ìƒëŒ€ë°© ì •ë³´ (ì–‘ë ¥ ê¸°ì¤€)</h3>
                        <div class="form-group">
                            <select id="partner-year" class="year-select"></select>
                            <select id="partner-month">
                                <option value="" disabled selected>ì›”</option>
                                ${Array.from({length: 12}, (_, i) => `<option value="${i+1}">${i+1}ì›”</option>`).join('')}
                            </select>
                            <select id="partner-day">
                                <option value="" disabled selected>ì¼</option>
                                ${Array.from({length: 31}, (_, i) => `<option value="${i+1}">${i+1}ì¼</option>`).join('')}
                            </select>
                            <select id="partner-hour" class="hour-select"></select>
                        </div>
                    </div>

                    <button id="generate-btn" class="btn btn-primary w-full">
                        ìš´ì„¸ ê²°ê³¼ ë³´ê¸°
                    </button>
                </section>
            `;
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë° ì´ˆê¸°í™”
            populateYears('.year-select');
            populateJishi('.hour-select');

            const menuCards = document.querySelectorAll('.menu-card');
            menuCards.forEach(card => {
                card.addEventListener('click', function() {
                    menuCards.forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    const mode = this.getAttribute('data-mode');
                    toggleInputForms(mode);
                });
            });

            document.getElementById('generate-btn').addEventListener('click', handleGenerateFortune);
            toggleInputForms(null);
        }

        function renderAdView() {
            const mainEl = document.getElementById('app-main');
            mainEl.innerHTML = `
                <section class="card ad-page">
                    <h2 class="text-2xl font-bold mb-4" style="color: var(--color-accent);" id="ad-status">
                        ìš´ì„¸ ê²°ê³¼ë¥¼ ìœ„í•œ ê´‘ê³ ë¥¼ 30ì´ˆê°„ ì‹œì²­í•´ì•¼ í•©ë‹ˆë‹¤.
                    </h2>
                    
                    <p class="text-lg font-semibold mb-4">ë‚¨ì€ ì‹œê°„:</p>
                    <div id="countdown" class="countdown">30</div>
                    
                    <div class="ad-area">
                        <span>[ê´‘ê³  Placeholder]</span>
                    </div>

                    <button id="result-btn" class="btn w-full max-w-xs mt-6 btn-disabled" disabled>
                        ê²°ê³¼ í™•ì¸í•˜ê¸°
                    </button>
                    <p class="text-sm text-gray-500 mt-2">â€» ì¹´ìš´íŠ¸ë‹¤ìš´ì´ 0ì´ ë˜ë©´ ë²„íŠ¼ì´ í™œì„±í™”ë©ë‹ˆë‹¤.</p>
                </section>
            `;

            // Ad ë·° ë¡œì§ (ì¹´ìš´íŠ¸ë‹¤ìš´)
            const COUNTDOWN_SECONDS = 30;
            let timer = COUNTDOWN_SECONDS;
            let countdownInterval;
            const countdownEl = document.getElementById('countdown');
            const resultBtn = document.getElementById('result-btn');

            resultBtn.disabled = true;
            
            countdownInterval = setInterval(() => {
                timer--;
                countdownEl.textContent = timer;

                if (timer <= 0) {
                    clearInterval(countdownInterval);
                    countdownEl.textContent = "í™•ì¸ ê°€ëŠ¥!";
                    document.getElementById('ad-status').textContent = "ê´‘ê³  ì‹œì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.";
                    
                    resultBtn.disabled = false;
                    resultBtn.classList.remove('btn-disabled');
                    resultBtn.classList.add('btn-primary');
                }
            }, 1000);

            resultBtn.addEventListener('click', () => {
                if (!resultBtn.disabled) {
                    clearInterval(countdownInterval);
                    navigateTo('result'); // result.html ëŒ€ì‹  result ë·°ë¡œ ì´ë™
                }
            });
        }

        function renderResultView() {
             const mainEl = document.getElementById('app-main');
            mainEl.innerHTML = `
                <section class="result-header">
                    <h2 id="result-title">ìš´ì„¸ ê²°ê³¼</h2>
                    
                    <div class="flex flex-col items-center justify-center text-sm text-gray-500">
                        <div id="user-info-display"></div>
                        <div id="partner-info-display"></div>
                    </div>

                    <p id="result-summary" class="text-xl font-bold"></p>
                </section>

                <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ ë° ë©”ì‹œì§€ (JSë¡œ í† ê¸€ë¨) -->
                <div id="loading-spinner">
                    <div class="spinner"></div>
                    <p>ìš´ì„¸ ê²°ê³¼ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</p>
                    <p class="text-sm text-gray-500 mt-2">
                        (AI ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤.ìµœëŒ€ 10~20ì´ˆ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)
                    </p>
                </div>
                
                <div id="result-content-wrapper" style="display: none;">
                    <!-- ìš´ì„¸ ê²°ê³¼ ì„¹ì…˜ (JSë¡œ ë‚´ìš© ì±„ì›Œì§) -->
                    <section id="fortune-result-container"></section>
                    
                    <div class="text-center pt-8 pb-4">
                        <a href="#" id="go-home-btn" class="btn btn-primary">
                            ë‹¤ë¥¸ ìš´ì„¸ ë³´ëŸ¬ê°€ê¸°
                        </a>
                    </div>
                </div>
            `;
            
            document.getElementById('go-home-btn').addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo('main');
            });

            // ê²°ê³¼ í˜ì´ì§€ ë¡œì§ ì‹œì‘
            initializeResultPage();
        }

        // =================================================================================
        // ì´ˆê¸°í™”
        // =================================================================================
        window.onload = function() {
            document.querySelector('.site-title').textContent = SITE_NAME;
            navigateTo('main'); // ì‹œì‘ ì‹œ ë©”ì¸ ë·° ë¡œë“œ
        };

    </script>
</body>
</html>
